sourceSets {
    benchmark {
        java {
            compileClasspath += main.output + test.output
            runtimeClasspath += main.output + test.output
            srcDir 'src/benchmark/java'
        }
        resources.srcDir 'src/benchmark/resources'
    }
}

configurations {
    benchmarkImplementation.extendsFrom implementation, testImplementation
}

task benchmark(type: Test) {
    doFirst{
        def grgit = grgit.clone(dir: 'git_temp_dir/', uri: scmProjectUrl, checkout: true,
                refToCheckout: '155-benchmark-tests')
    }
    testClassesDirs = sourceSets.benchmark.output.classesDirs
    classpath = sourceSets.benchmark.runtimeClasspath
    outputs.upToDateWhen { false }
}

task benchmarkCommit() {
    doLast{
        def filePath = System.getenv('TRAVIS_BUILD_DIR') + '/git_temp_dir/docs/BENCHMARKS.md'
        printf('Will try to commit the file:' + filePath)
        grgit = grgit.open(dir: System.getenv('TRAVIS_BUILD_DIR') + '/git_temp_dir')
        grgit.add(patterns: 'docs/BENCHMARKS.md')
        grgit.commit(message: 'Add benchmark result.')
        grgit.push()
        grgit.close()
    }
}

benchmarkCommit.mustRunAfter benchmark